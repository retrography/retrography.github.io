<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Retrography &middot; backwardly writing...
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="//public/css/poole.css">
  <link rel="stylesheet" href="//public/css/syntax.css">
  <link rel="stylesheet" href="//public/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="//public/favicon.ico?v=2">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="theme-base-08 layout-reverse sidebar-overlay">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>This is where I put the rest of the stuff.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item active" href="/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="/about/">About</a>
        
      
    
      
    

<!--    <a class="sidebar-nav-item" href="/archive/v1.0.0.zip">Download</a>
    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span> -->
  </nav>

  <div class="sidebar-item">
    <p>

<a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png" />
</a>The content of this website is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.

<!--      &copy; 2015. All rights reserved. -->
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Retrography</a>
            <small>backwardly writing...</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/10/27/so-scriptella-works-with-neo4j/">
        So, Scriptella Works With Neo4j
      </a>
    </h1>

    <span class="post-date">27 Oct 2014</span>

    <p>We all know that Neo4j&#39;s Cypher has recently had a language upgrade to accommodate ETL. Yes, the graph engine now supports <code>LOAD CSV</code> within Cypher scripts. </p>

<p>CSV is a great data interchange format, specially because one can edit, manipulate and filter it with simple command line tools. The only caveat is that it requires a full export of all data into a text-only format with no widely-accepted standard for reading and writing it. </p>

<p>You may run into issues as simple as text encoding and as complicated as converting string array fields into plain text. Furthermore, <code>LOAD CSV</code> is only for importing. </p>

<p>What if we need to migrate some data back to the good old RDBMS? Isn&#39;t there a better, one-shot way for migrating some of our precious graph data into another database? </p>

<p>Thanks to <a href="https://github.com/neo4j-contrib/neo4j-jdbc">Neo4j&#39;s JDBC driver</a>, you can. But then most end-user ETL or data migration applications don&#39;t really like a driver that speaks Cypher rather than SQL, and run into all sorts of errors while trying to automatize some aspects of your data access when using Neo4j&#39;s JDBC driver. </p>

<p>One tool that lets you benefit from all the facilities offered by the standardized Java database interfaces and yet perfectly obeys your orders is <a href="http://scriptella.javaforge.com">Scriptella</a>. </p>

<p>Below is a Scriptella configuration code that shows how to use MySQL and Neo4j JDBC drivers along with Scriptella to run an ETL process. All you need to do is to put the <code>etl.xml</code> file in Scriptella&#39;s <code>bin</code> directory, the JDBC driver files in <code>lib</code> directory, and run Scriptella. </p>

<script src="https://gist.github.com/retrography/1295ba19d0caa73a5dfe.js"> </script>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="lineno"> 1</span> <span class="cp">&lt;!DOCTYPE etl SYSTEM &quot;http://scriptella.javaforge.com/dtd/etl.dtd&quot;&gt;</span>
<span class="lineno"> 2</span> <span class="nt">&lt;etl&gt;</span>
<span class="lineno"> 3</span>     <span class="nt">&lt;description&gt;</span>Scriptella ETL File Template.<span class="nt">&lt;/description&gt;</span>
<span class="lineno"> 4</span>     
<span class="lineno"> 5</span>     <span class="c">&lt;!-- Connections with batch-loading configuration --&gt;</span>    
<span class="lineno"> 6</span>     <span class="nt">&lt;connection</span> <span class="na">id=</span><span class="s">&quot;graph&quot;</span> <span class="na">driver=</span><span class="s">&quot;org.neo4j.jdbc.Driver&quot;</span> 
<span class="lineno"> 7</span>         <span class="na">url=</span><span class="s">&quot;jdbc:neo4j://graphserver:7474&quot;</span><span class="nt">&gt;</span>
<span class="lineno"> 8</span>         statement.fetchSize = 1000
<span class="lineno"> 9</span>     <span class="nt">&lt;/connection&gt;</span>
<span class="lineno">10</span> 
<span class="lineno">11</span>     <span class="nt">&lt;connection</span> <span class="na">id=</span><span class="s">&quot;project&quot;</span> <span class="na">driver=</span><span class="s">&quot;com.mysql.jdbc.Driver&quot;</span> 
<span class="lineno">12</span>         <span class="na">url=</span><span class="s">&quot;jdbc:mysql://sqlserver:3306/database&quot;</span> <span class="na">user=</span><span class="s">&quot;root&quot;</span> <span class="na">password=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
<span class="lineno">13</span>         statement.batchSize = 1000
<span class="lineno">14</span>     <span class="nt">&lt;/connection&gt;</span>
<span class="lineno">15</span>     
<span class="lineno">16</span>     <span class="c">&lt;!-- ETL Queries and Scripts --&gt;</span>
<span class="lineno">17</span>     <span class="nt">&lt;query</span> <span class="na">connection-id=</span><span class="s">&quot;graph&quot;</span><span class="nt">&gt;</span>
<span class="lineno">18</span>         MATCH (p:Package)-[r1]-(f:File)-[r2]-(s:Snippet) 
<span class="lineno">19</span>         RETURN p.title AS package, f.name AS file, s.sha AS sha 
<span class="lineno">20</span>         ORDER BY p.title;
<span class="lineno">21</span> 
<span class="lineno">22</span>         <span class="nt">&lt;script</span> <span class="na">connection-id=</span><span class="s">&quot;project&quot;</span><span class="nt">&gt;</span>
<span class="lineno">23</span>             INSERT INTO test (package, file, sha) 
<span class="lineno">24</span>             VALUES (?package, ?file, ?sha);
<span class="lineno">25</span>         <span class="nt">&lt;/script&gt;</span>
<span class="lineno">26</span>     <span class="nt">&lt;/query&gt;</span>
<span class="lineno">27</span> <span class="nt">&lt;/etl&gt;</span></code></pre></div>

<p><a href="https://gist.github.com/retrography/1295ba19d0caa73a5dfe#file-etl-xml">Gist</a> | <a href="https://gist.github.com/retrography/1295ba19d0caa73a5dfe/download">Download</a></p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="/2014/05/03/so-one-day-neo4j-goes-to-r/">
        So, One Day Neo4j Goes to R
      </a>
    </h1>

    <span class="post-date">03 May 2014</span>

    <p>There is an easy way to fetch graph data from Neo4j directly into R environment using a simple REST API client:</p>

<script src="https://gist.github.com/retrography/fdbf658116ddb7fa7c51.js"> </script>

<div class="highlight"><pre><code class="language-r" data-lang="r"><span class="lineno"> 1</span> <span class="kn">library</span><span class="p">(</span><span class="s">&#39;RCurl&#39;</span><span class="p">)</span>
<span class="lineno"> 2</span> <span class="kn">library</span><span class="p">(</span><span class="s">&#39;RJSONIO&#39;</span><span class="p">)</span>
<span class="lineno"> 3</span> 
<span class="lineno"> 4</span> query <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>querystring<span class="p">)</span> <span class="p">{</span>
<span class="lineno"> 5</span>   h <span class="o">=</span> basicTextGatherer<span class="p">()</span>
<span class="lineno"> 6</span>   curlPerform<span class="p">(</span>url<span class="o">=</span><span class="s">&quot;http://localhost:7474/db/data/cypher&quot;</span><span class="p">,</span>
<span class="lineno"> 7</span>     postfields<span class="o">=</span><span class="kp">paste</span><span class="p">(</span><span class="s">&#39;query&#39;</span><span class="p">,</span>curlEscape<span class="p">(</span>querystring<span class="p">),</span> sep<span class="o">=</span><span class="s">&#39;=&#39;</span><span class="p">),</span>
<span class="lineno"> 8</span>     writefunction <span class="o">=</span> h<span class="o">$</span>update<span class="p">,</span>
<span class="lineno"> 9</span>     verbose <span class="o">=</span> <span class="kc">FALSE</span>
<span class="lineno">10</span>   <span class="p">)</span>
<span class="lineno">11</span>  
<span class="lineno">12</span>   result <span class="o">&lt;-</span> fromJSON<span class="p">(</span>h<span class="o">$</span>value<span class="p">())</span>
<span class="lineno">13</span>   
<span class="lineno">14</span>   data <span class="o">&lt;-</span> <span class="kt">data.frame</span><span class="p">(</span><span class="kp">t</span><span class="p">(</span><span class="kp">sapply</span><span class="p">(</span>result<span class="o">$</span>data<span class="p">,</span> <span class="kp">unlist</span><span class="p">)))</span>
<span class="lineno">15</span>   <span class="kp">names</span><span class="p">(</span>data<span class="p">)</span> <span class="o">&lt;-</span> result<span class="o">$</span>columns
<span class="lineno">16</span>   
<span class="lineno">17</span>   data 
<span class="lineno">18</span> <span class="p">}</span> 
<span class="lineno">19</span>  
<span class="lineno">20</span> <span class="c1"># EXAMPLE</span>
<span class="lineno">21</span> <span class="c1"># =======</span>
<span class="lineno">22</span>  
<span class="lineno">23</span> <span class="c1"># Cypher Query:</span>
<span class="lineno">24</span> <span class="o">&gt;</span>q <span class="o">&lt;-</span> <span class="s">&quot;</span>
<span class="lineno">25</span> <span class="s">match (o:Organization)-[r]-(p:Person) return o.name,o.location,p.account,p.name,p.email limit 20</span>
<span class="lineno">26</span> <span class="s">&quot;</span> 
<span class="lineno">27</span> <span class="o">&gt;</span>data <span class="o">&lt;-</span>query<span class="p">(</span><span class="kp">q</span><span class="p">)</span></code></pre></div>

<p><strong><em>Caution:</em></strong> This script runs into trouble if the query response is in a non-tabular format or includes missing values. </p>

<p>Neo4j does not support null-valued properties and any property with a null value is removed from the database. In other words running <code>SET node.property = NULL</code> elicits the same result as running <code>REMOVE node.property</code>, which means it deletes the property. Neo4j&#39;s REST API responds to queries in JSON, which is schema-less as well, and does not represent missing properties in any way. When converting the JSON output to a tabular format, this results in rows with variable number of columns. </p>

<p>In case your database contains missing values, either replace them with symbolic values or convert them on the fly within your query. If none of these is an option, you need to use a tabular format like CSV for data interchange.</p>

<p><a href="https://gist.github.com/retrography/fdbf658116ddb7fa7c51#file-neo4r_example-r">Gist</a> | <a href="https://gist.github.com/retrography/fdbf658116ddb7fa7c51/download">Download</a> - Credit goes to <a href="https://gist.github.com/mhermans">Maarten Hermans</a></p>

  </div>
  
</div>

<div class="pagination">
  
    <span class="pagination-item older">Older</span>
  
  
    <span class="pagination-item newer">Newer</span>
  
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
