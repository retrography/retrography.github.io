<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

 <title>Retrography</title>
 <link href="http://retrography.github.com/atom.xml" rel="self"/>
 <link href="http://retrography.github.com/"/>
 <updated>2015-01-16T22:49:41-05:00</updated>
 <id>http://retrography.github.com</id>
 <author>
   <name>Mahmood Zargar</name>
   <email>mahmood@gmail.com</email>
 </author>

 
 <entry>
   <title>So, Scriptella Works With Neo4j</title>
   <link href="http://retrography.github.com/2014/10/27/so-scriptella-works-with-neo4j/"/>
   <updated>2014-10-27T00:00:00-04:00</updated>
   <id>http://retrography.github.com/2014/10/27/so-scriptella-works-with-neo4j</id>
   <content type="html">&lt;p&gt;We all know that Neo4j&amp;#39;s Cypher has recently had a language upgrade to accommodate ETL. Yes, the graph engine now supports &lt;code&gt;LOAD CSV&lt;/code&gt; within Cypher scripts. &lt;/p&gt;

&lt;p&gt;CSV is a great data interchange format, specially because one can edit, manipulate and filter it with simple command line tools. The only caveat is that it requires a full export of all data into a text-only format with no widely-accepted standard for reading and writing it. &lt;/p&gt;

&lt;p&gt;You may run into issues as simple as text encoding and as complicated as converting string array fields into plain text. Furthermore, &lt;code&gt;LOAD CSV&lt;/code&gt; is only for importing. &lt;/p&gt;

&lt;p&gt;What if we need to migrate some data back to the good old RDBMS? Isn&amp;#39;t there a better, one-shot way for migrating some of our precious graph data into another database? &lt;/p&gt;

&lt;p&gt;Thanks to &lt;a href=&quot;https://github.com/neo4j-contrib/neo4j-jdbc&quot;&gt;Neo4j&amp;#39;s JDBC driver&lt;/a&gt;, you can. But then most end-user ETL or data migration applications don&amp;#39;t really like a driver that speaks Cypher rather than SQL, and run into all sorts of errors while trying to automatize some aspects of your data access when using Neo4j&amp;#39;s JDBC driver. &lt;/p&gt;

&lt;p&gt;One tool that lets you benefit from all the facilities offered by the standardized Java database interfaces and yet perfectly obeys your orders is &lt;a href=&quot;http://scriptella.javaforge.com&quot;&gt;Scriptella&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;Below is a Scriptella configuration code that shows how to use MySQL and Neo4j JDBC drivers along with Scriptella to run an ETL process. All you need to do is to put the &lt;code&gt;etl.xml&lt;/code&gt; file in Scriptella&amp;#39;s &lt;code&gt;bin&lt;/code&gt; directory, the JDBC driver files in &lt;code&gt;lib&lt;/code&gt; directory, and run Scriptella. &lt;/p&gt;

&lt;script src=&quot;https://gist.github.com/retrography/1295ba19d0caa73a5dfe.js&quot;&gt; &lt;/script&gt;

&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-xml&quot; data-lang=&quot;xml&quot;&gt;&lt;span class=&quot;lineno&quot;&gt; 1&lt;/span&gt; &lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE etl SYSTEM &amp;quot;http://scriptella.javaforge.com/dtd/etl.dtd&amp;quot;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 2&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;etl&amp;gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 3&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;&amp;lt;description&amp;gt;&lt;/span&gt;Scriptella ETL File Template.&lt;span class=&quot;nt&quot;&gt;&amp;lt;/description&amp;gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 4&lt;/span&gt;     
&lt;span class=&quot;lineno&quot;&gt; 5&lt;/span&gt;     &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Connections with batch-loading configuration --&amp;gt;&lt;/span&gt;    
&lt;span class=&quot;lineno&quot;&gt; 6&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;&amp;lt;connection&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;graph&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;driver=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;org.neo4j.jdbc.Driver&amp;quot;&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt; 7&lt;/span&gt;         &lt;span class=&quot;na&quot;&gt;url=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;jdbc:neo4j://graphserver:7474&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt; 8&lt;/span&gt;         statement.fetchSize = 1000
&lt;span class=&quot;lineno&quot;&gt; 9&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;&amp;lt;/connection&amp;gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;10&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;11&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;&amp;lt;connection&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;project&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;driver=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;com.mysql.jdbc.Driver&amp;quot;&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;12&lt;/span&gt;         &lt;span class=&quot;na&quot;&gt;url=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;jdbc:mysql://sqlserver:3306/database&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;user=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;root&amp;quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;password=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;13&lt;/span&gt;         statement.batchSize = 1000
&lt;span class=&quot;lineno&quot;&gt;14&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;&amp;lt;/connection&amp;gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;15&lt;/span&gt;     
&lt;span class=&quot;lineno&quot;&gt;16&lt;/span&gt;     &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- ETL Queries and Scripts --&amp;gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;17&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;&amp;lt;query&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;connection-id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;graph&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;18&lt;/span&gt;         MATCH (p:Package)-[r1]-(f:File)-[r2]-(s:Snippet) 
&lt;span class=&quot;lineno&quot;&gt;19&lt;/span&gt;         RETURN p.title AS package, f.name AS file, s.sha AS sha 
&lt;span class=&quot;lineno&quot;&gt;20&lt;/span&gt;         ORDER BY p.title;
&lt;span class=&quot;lineno&quot;&gt;21&lt;/span&gt; 
&lt;span class=&quot;lineno&quot;&gt;22&lt;/span&gt;         &lt;span class=&quot;nt&quot;&gt;&amp;lt;script&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;connection-id=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;project&amp;quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;23&lt;/span&gt;             INSERT INTO test (package, file, sha) 
&lt;span class=&quot;lineno&quot;&gt;24&lt;/span&gt;             VALUES (?package, ?file, ?sha);
&lt;span class=&quot;lineno&quot;&gt;25&lt;/span&gt;         &lt;span class=&quot;nt&quot;&gt;&amp;lt;/script&amp;gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;26&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;&amp;lt;/query&amp;gt;&lt;/span&gt;
&lt;span class=&quot;lineno&quot;&gt;27&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;/etl&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://gist.github.com/retrography/1295ba19d0caa73a5dfe#file-etl-xml&quot;&gt;Gist&lt;/a&gt; | &lt;a href=&quot;https://gist.github.com/retrography/1295ba19d0caa73a5dfe/download&quot;&gt;Download&lt;/a&gt;&lt;/p&gt;
</content>
 </entry>
 
 <entry>
   <title>So, One Day Neo4j Goes to R</title>
   <link href="http://retrography.github.com/2014/05/03/so-one-day-neo4j-goes-to-r/"/>
   <updated>2014-05-03T00:00:00-04:00</updated>
   <id>http://retrography.github.com/2014/05/03/so-one-day-neo4j-goes-to-r</id>
   <content type="html">&lt;p&gt;There is an easy way to fetch graph data from Neo4j directly into R environment using a simple REST API client:&lt;/p&gt;
&lt;div class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-text&quot; data-lang=&quot;text&quot;&gt;library(&amp;#39;RCurl&amp;#39;)
library(&amp;#39;RJSONIO&amp;#39;)

query &amp;lt;- function(querystring) {
  h = basicTextGatherer()
  curlPerform(url=&amp;quot;http://localhost:7474/db/data/cypher&amp;quot;,
    postfields=paste(&amp;#39;query&amp;#39;,curlEscape(querystring), sep=&amp;#39;=&amp;#39;),
    writefunction = h$update,
    verbose = FALSE
  )

  result &amp;lt;- fromJSON(h$value())

  data &amp;lt;- data.frame(t(sapply(result$data, unlist)))
  names(data) &amp;lt;- result$columns

  data 
}


# EXAMPLE
# =======

# Cypher Query:
&amp;gt;q &amp;lt;- &amp;quot;
match (o:Organization)-[r]-(p:Person) return o.name,o.location,p.account,p.name,p.email limit 20
&amp;quot; 
&amp;gt;data &amp;lt;-query(q)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;&lt;em&gt;Caution:&lt;/em&gt;&lt;/strong&gt; This script runs into trouble if the query response is in a non-tabular format or includes missing values. &lt;/p&gt;

&lt;p&gt;Neo4j does not support null-valued properties and any property with a null value is removed from the database. In other words running &lt;code&gt;SET node.property = NULL&lt;/code&gt; elicits the same result as running &lt;code&gt;REMOVE node.property&lt;/code&gt;, which means it deletes the property. Neo4j&amp;#39;s REST API responds to queries in JSON, which is schema-less as well, and does not represent missing properties in any way. When converting the JSON output to a tabular format, this results in rows with variable number of columns. &lt;/p&gt;

&lt;p&gt;In case your database contains missing values, either replace them with symbolic values or convert them on the fly within your query. If none of these is an option, you need to use a tabular format like CSV for data interchange.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://gist.github.com/retrography/fdbf658116ddb7fa7c51#file-neo4r_example-r&quot;&gt;Gist&lt;/a&gt; | &lt;a href=&quot;https://gist.github.com/retrography/fdbf658116ddb7fa7c51/download&quot;&gt;Download&lt;/a&gt; - Credit goes to &lt;a href=&quot;https://gist.github.com/mhermans&quot;&gt;Maarten Hermans&lt;/a&gt;&lt;/p&gt;
</content>
 </entry>
 

</feed>
